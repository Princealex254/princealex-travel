<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Prince Alex Travel Services</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
    const SUPABASE_URL = 'https://numnzxrnrlxvkjwlusbe.supabase.co'; 
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im51bW56eHJucmx4dmtqd2x1c2JlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEyMTgxNzgsImV4cCI6MjA2Njc5NDQ1OH0.03mPw9Y7tuWne5SNpsag7lYhQSZ6HqA8YmDSxVMVMFg'; 

    const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    </script>
    <style>
        /* Use: Defines custom CSS variables for consistent theming. */
        :root {
            --primary-color: #002d6b; /* Use: Main brand color, e.g., for navbar, headings. */
            --accent-color: #c69214; /* Use: Highlight color, e.g., for buttons, hover effects. */
            --light-bg: #f5f7fa; /* Use: Light background color for sections. */
            --text-dark: #1a1a1a; /* Use: Dark text color. */
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            /* Use: Resets default browser margins/paddings and sets box model for consistent sizing. */
        }
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--light-bg);
            color: var(--text-dark);
            /* Use: Sets global font, background, and text color. */
        }
        .navbar {
            background-color: var(--primary-color);
            padding: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            /* Use: Styles the top navigation bar with a background, padding, and subtle shadow. */
        }
        .navbar-container {
            max-width: 1200px;
            margin: auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            /* Use: Centers and arranges navigation elements horizontally within the navbar. */
        }
        .logo {
            background-color: white;
            padding: 10px 15px;
            border-radius: 12px;
            box-shadow: 0 0 8px rgba(0,0,0,0.2);
            /* Use: Styles the logo container with a white background, rounded corners, and shadow. */
        }
        .logo img {
            height: 80px;
            display: block;
            /* Use: Sizes the logo image within its container. */
        }
        .nav-links {
            display: flex;
            gap: 25px;
            /* Use: Arranges navigation links horizontally with spacing. */
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
            position: relative;
            /* Use: Styles individual navigation links, setting color, removing underlines, and positioning for hover effect. */
        }
        .nav-links a::after {
            content: '';
            display: block;
            width: 0;
            height: 2px;
            background: var(--accent-color);
            transition: width 0.3s;
            position: absolute;
            bottom: -5px;
            left: 0;
            /* Use: Creates an animated underline that appears on hover. */
        }
        .nav-links a:hover::after {
            width: 100%;
            /* Use: Expands the underline width on hover. */
        }
        .nav-links a:hover {
            color: var(--accent-color);
            /* Use: Changes link color on hover. */
        }
        .hero {
            background: linear-gradient(to right, var(--primary-color), #001c44);
            color: white;
            padding: 80px 20px;
            text-align: center;
            /* Use: Styles the hero section with a gradient background, white text, and centering. */
        }
        .hero h1 {
            font-size: 36px;
            margin-bottom: 10px;
            /* Use: Styles the main heading in the hero section. */
        }
        .hero p {
            font-size: 18px;
            opacity: 0.9;
            /* Use: Styles the paragraph text in the hero section. */
        }
        .booking {
            background-color: white;
            padding: 60px 20px;
            text-align: center;
            /* Use: Styles the booking section background and padding. */
        }
        .booking-container {
            max-width: 1000px;
            margin: auto;
            /* Use: Centers the content within the booking section. */
        }
        .booking h2 {
            margin-bottom: 30px;
            color: var(--primary-color);
            /* Use: Styles the heading for the booking form. */
        }
        .booking-form {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            /* Use: Arranges booking form elements horizontally with wrapping and centering. */
        }
        .booking-form select,
        .booking-form input[type="date"] {
            padding: 12px 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 15px;
            min-width: 180px;
            /* Use: Styles dropdowns and date input fields in the form. */
        }
        .booking-form button[type="submit"] {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 14px 24px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
            /* Use: Styles the search submit button. */
        }
        .booking-form button:hover {
            background-color: #b27e0f;
            /* Use: Darkens the submit button on hover. */
        }
        .results-section {
            max-width: 1000px;
            margin: 40px auto;
            padding: 20px;
            display: none; /* Initially hidden, controlled by JS */
            /* Use: Styles the section where search results will be displayed, initially hidden. */
        }
        .results-section.active {
            display: block;
            /* Use: Makes the results section visible when the 'active' class is added by JavaScript. */
        }
        .results-section h2 {
            margin-bottom: 30px;
            color: #002d6b;
            text-align: center; /* Center the results heading */
            /* Use: Styles the heading for the search results. */
        }
        .result-card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
            /* Use: Styles individual bus result cards with background, shadow, and flexible layout. */
        }
        .result-card img {
            width: 150px;
            height: 100px;
            border-radius: 8px;
            object-fit: cover;
            flex-shrink: 0; /* Prevent image from shrinking */
            /* Use: Styles the bus image within a result card. */
        }
        .result-details {
            flex: 1;
            min-width: 200px; /* Ensure details don't get too small */
            /* Use: Styles the container for bus details within a result card. */
        }
        .result-details h4 {
            margin: 0 0 10px;
            color: #002d6b;
            /* Use: Styles the route heading in result details. */
        }
        .result-details p {
            margin: 5px 0;
            font-size: 0.95em;
            /* Use: Styles paragraph text (departure, price, seats) in result details. */
        }
        .book-btn {
            background-color: var(--accent-color);
            color: white;
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease;
            margin-left: auto; /* Push button to the right */
            flex-shrink: 0; /* Prevent button from shrinking */
            /* Use: Styles the "Book Now" button in result cards. */
        }
        .book-btn:hover {
            background-color: #b27e0f;
            /* Use: Darkens the "Book Now" button on hover. */
        }
        .gallery {
            padding: 60px 20px;
            background-color: white;
            text-align: center;
            /* Use: Styles the gallery section background and padding. */
        }
        .gallery h2 {
            color: var(--primary-color);
            margin-bottom: 30px;
            font-size: 28px;
            /* Use: Styles the heading for the image gallery. */
        }
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1000px;
            margin: 0 auto;
            /* Use: Creates a responsive grid layout for gallery images. */
        }
        .image-grid img {
            width: 100%;
            height: auto;
            border-radius: 12px;
            object-fit: cover;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            /* Use: Styles individual gallery images with rounded corners, shadow, and zoom effect on hover. */
        }
        .image-grid img:hover {
            transform: scale(1.03);
            /* Use: Slightly scales up the image on hover. */
        }
        .footer {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 14px;
            /* Use: Styles the footer background, text color, padding, and font size. */
        }
        .footer-content {
            max-width: 1000px;
            margin: auto;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 20px;
            text-align: left;
            /* Use: Arranges footer sections horizontally with wrapping and spacing. */
        }
        .footer-section {
            flex: 1;
            min-width: 200px;
            /* Use: Styles individual sections within the footer. */
        }
        .footer-section h4 {
            color: var(--accent-color);
            margin-bottom: 10px;
            /* Use: Styles headings within footer sections. */
        }
        .footer-section a,
        .footer-section p {
            display: block;
            color: white;
            margin: 4px 0;
            text-decoration: none;
            /* Use: Styles links and paragraphs within footer sections. */
        }
        .footer-section a:hover {
            text-decoration: underline;
            /* Use: Adds underline to footer links on hover. */
        }
        .footer-bottom {
            margin-top: 20px;
            text-align: center;
            font-size: 13px;
            opacity: 0.8;
            /* Use: Styles the copyright text at the bottom of the footer. */
        }

        /* --- Seat Selection Modal Styling --- */
        #seatModal {
            display: none; /* Initially hidden, controlled by JS */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7); /* Darker overlay */
            z-index: 9999;
            display: flex; /* Use flexbox for centering when visible */
            justify-content: center;
            align-items: center;
            padding: 20px; /* Add some padding for smaller screens */
            box-sizing: border-box; /* Include padding in element's total width and height */
            /* Use: Styles the modal overlay for seat selection, making it full screen and centered. */
        }

        #seatModal > div {
            background:#fff;
            max-width:700px; /* Slightly wider for 32 seats */
            width: 100%; /* Ensure it takes available width */
            padding:30px;
            border-radius:12px;
            position:relative;
            box-shadow: 0 8px 16px rgba(0,0,0,0.25);
            max-height: 90vh; /* Limit height for scrollability */
            overflow-y: auto; /* Enable scrolling if content overflows */
            /* Use: Styles the modal content box (white background, rounded corners, shadow, scrollable). */
        }

        #seatModal h3 {
            margin-bottom:20px;
            color: var(--primary-color); /* Using your primary color */
            text-align: center;
            font-size: 1.8em;
            /* Use: Styles the heading inside the seat selection modal. */
        }

        #seatGrid {
            display:grid;
            grid-template-columns: repeat(4, 1fr); /* 4 columns for 32 seats (8 rows) */
            gap:12px; /* Slightly larger gap */
            margin-bottom:25px;
            justify-items: center; /* Center seat icons within their grid cells */
            padding: 10px;
            border: 1px dashed #ccc;
            border-radius: 8px;
            background-color: #fdfdfd;
            /* Use: Creates a grid layout for displaying bus seats. */
        }

        .seat-container {
            position: relative;
            width: 60px; /* Adjust size of seat container */
            height: 60px; /* Adjust size of seat container */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 8px;
            transition: transform 0.2s ease, background-color 0.2s ease;
            /* Use: Styles individual seat containers, making them clickable and setting initial appearance. */
        }

        .seat-container .seat-icon {
            font-size: 3em; /* Large seat icon */
            color: #7f8c8d; /* Default grey color for available seats */
            transition: color 0.2s ease;
            /* Use: Styles the Font Awesome chair icon within a seat. */
        }

        .seat-container .seat-number {
            font-size: 0.75em;
            font-weight: bold;
            color: #555;
            margin-top: 5px;
            /* Use: Styles the seat number label. */
        }

        /* Styles for Selected Seat */
        .seat-container.selected .seat-icon {
            color: var(--accent-color); /* Using your accent color for selected */
            /* Use: Changes seat icon color to accent color when selected. */
        }
        .seat-container.selected .seat-number {
            color: var(--accent-color);
            /* Use: Changes seat number color to accent color when selected. */
        }
        .seat-container.selected {
            background-color: #fcefdc; /* Light accent background */
            transform: scale(1.05);
            /* Use: Adds a light background and slight scale effect to selected seats. */
        }

        /* Styles for Booked Seat */
        .seat-container.booked {
            cursor: not-allowed;
            /* Use: Changes cursor for booked seats to indicate they are not clickable. */
        }
        .seat-container.booked .seat-icon {
            color: #c0392b; /* Red for booked */
            /* Use: Changes seat icon color to red for booked seats. */
        }
        .seat-container.booked .seat-number {
            color: #c0392b;
            /* Use: Changes seat number color to red for booked seats. */
        }
        .seat-container.booked::after {
            content: 'X'; /* Add an 'X' for booked seats */
            position: absolute;
            font-size: 2.5em;
            color: rgba(255, 255, 255, 0.7);
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
            background-color: rgba(0,0,0,0.3); /* Dark overlay */
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 8px;
            top: 0; /* Position correctly over the seat */
            left: 0; /* Position correctly over the seat */
            /* Use: Adds a semi-transparent 'X' overlay to visually mark booked seats. */
        }

        /* Input Fields in Modal */
        #seatModal input[type="text"],
        #seatModal input[type="tel"],
        #seatModal input[type="email"],
        #seatModal select { /* Added select for gender */
            padding:12px 15px;
            width:100%;
            margin-bottom:15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box; /* Crucial for width to include padding and border */
            font-size: 1em;
            /* Use: Styles input fields and dropdowns within the seat selection modal. */
        }

        /* Modal Buttons */
        #seatModal button {
            padding:12px 25px;
            border:none;
            border-radius:8px;
            cursor:pointer;
            font-size: 1.05em;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.1s ease;
            /* Use: Base styles for buttons within the seat selection modal. */
        }

        #seatModal button:active {
            transform: translateY(1px); /* Slight press effect */
            /* Use: Adds a subtle press effect when modal buttons are clicked. */
        }

        #seatModal button[onclick="confirmBooking()"] {
            background: var(--accent-color); /* Use accent color for proceed */
            color:white;
            /* Use: Styles the "Proceed to Pay" button with the accent color. */
        }

        #seatModal button[onclick="confirmBooking()"]:hover {
            background-color: #b27e0f; /* Darker accent */
            /* Use: Darkens "Proceed to Pay" button on hover. */
        }

        #seatModal button[onclick="closeModal()"] {
            margin-left:10px;
            background:#ccc; /* Grey for cancel */
            color: var(--text-dark); /* Dark text on grey */
            /* Use: Styles the "Cancel" button. */
        }

        #seatModal button[onclick="closeModal()"]:hover {
            background-color: #bbb;
            /* Use: Darkens "Cancel" button on hover. */
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .navbar-container {
                flex-direction: column;
                gap: 15px;
            }
            /* Use: Adjusts navbar layout for tablets and smaller screens. */
            .hero {
                padding: 60px 20px;
            }
            .hero h1 {
                font-size: 30px;
            }
            /* Use: Adjusts hero section padding and heading size for smaller screens. */
            .booking-form {
                flex-direction: column;
                align-items: stretch;
            }
            .booking-form select,
            .booking-form input[type="date"],
            .booking-form button[type="submit"] {
                min-width: unset;
                width: 100%;
            }
            /* Use: Makes booking form elements stack vertically on smaller screens. */
            .result-card {
                flex-direction: column;
                align-items: flex-start;
            }
            /* Use: Makes result cards stack elements vertically on smaller screens. */
            .book-btn {
                margin-left: unset;
                margin-top: 15px;
                width: 100%;
            }
            /* Use: Adjusts "Book Now" button positioning and width for smaller screens. */
            #seatGrid {
                grid-template-columns: repeat(3, 1fr); /* 3 columns on smaller screens */
            }
            /* Use: Changes seat grid to 3 columns on smaller screens. */
            .seat-container {
                width: 50px;
                height: 50px;
            }
            .seat-container .seat-icon {
                font-size: 2.5em;
            }
            /* Use: Adjusts seat size and icon size for smaller screens. */
            #seatModal > div {
                margin: 20px; /* More margin on smaller screens */
                padding: 20px;
            }
            #seatModal input, #seatModal select { /* General rule for modal inputs */
                padding: 10px;
            }
            #seatModal button {
                padding: 10px 20px;
                font-size: 0.95em;
            }
            /* Use: Adjusts modal padding, input/button sizes for smaller screens. */
            .footer-content {
                flex-direction: column;
                text-align: center;
            }
            .footer-section {
                min-width: unset;
            }
            .footer-section h4 {
                text-align: center;
            }
            .footer-section a,
            .footer-section p {
                display: inline-block; /* For horizontal links/text in smaller screens */
                margin: 0 5px;
            }
            /* Use: Adjusts footer layout for smaller screens to stack sections. */
        }

        @media (max-width: 480px) {
            #seatGrid {
                grid-template-columns: repeat(2, 1fr); /* 2 columns on very small screens */
            }
            /* Use: Changes seat grid to 2 columns on very small screens. */
            .seat-container {
                width: 45px;
                height: 45px;
            }
            .seat-container .seat-icon {
                font-size: 2em;
            }
            /* Use: Further reduces seat and icon size for very small screens. */
            .book-now-btn, #seatModal button {
                font-size: 0.9em;
                padding: 10px 15px;
            }
            /* Use: Adjusts button font size and padding for very small screens. */
        }

        /* AI Assistant Button */
        #aiAssistantButton {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: var(--primary-color);
            color: rgb(245, 209, 4);
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8em;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            z-index: 10000; /* Ensure it's above everything */
            transition: background-color 0.3s ease, transform 0.3s ease;
            /* Use: Styles the floating AI assistant button (position, size, color, shadow). */
        }

        #aiAssistantButton:hover {
            background-color: #001c44; /* Darker primary */
            transform: scale(1.05);
            /* Use: Darkens and slightly scales the AI button on hover. */
        }

        /* AI Assistant Chat Interface */
        #aiAssistantChat {
            position: fixed;
            bottom: 100px; /* Position above the button */
            right: 30px;
            width: 320px;
            height: 400px;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s ease-in-out;
            transform: translateY(20px) scale(0.9);
            opacity: 0;
            pointer-events: none; /* Disable interaction when hidden */
            /* Use: Styles the AI chat window (position, size, appearance, initial hidden state). */
        }

        #aiAssistantChat.chat-visible {
            transform: translateY(0) scale(1);
            opacity: 1;
            pointer-events: auto; /* Enable interaction when visible */
            /* Use: Applies transformation and opacity to make chat window visible with animation. */
        }

        .chat-hidden {
            display: none; /* For initial state and complete hiding */
            /* Use: Hides the chat window completely when not in use. */
        }

        .chat-header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            /* Use: Styles the header of the chat window (background, text, layout). */
        }

        .chat-header h3 {
            margin: 0;
            font-size: 1.2em;
            /* Use: Styles the title in the chat header. */
        }

        .chat-close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px;
            line-height: 1;
            /* Use: Styles the close button in the chat header. */
        }

        .chat-close-btn:hover {
            color: var(--accent-color);
            /* Use: Changes close button color on hover. */
        }

        .chat-body {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            background-color: #f9f9f9;
            border-bottom: 1px solid #eee;
            /* Use: Styles the main message display area of the chat window (scrollable). */
        }

        .chat-footer {
            padding: 15px;
            display: flex;
            gap: 10px;
            border-top: 1px solid #eee;
            background-color: #f0f0f0;
            /* Use: Styles the input area at the bottom of the chat window. */
        }

        .chat-footer input[type="text"] {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.95em;
            /* Use: Styles the text input field in the chat footer. */
        }

        .chat-footer button {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease;
            /* Use: Styles the "Send" button in the chat footer. */
        }

        .chat-footer button:hover {
            background-color: #b27e0f;
            /* Use: Darkens the "Send" button on hover. */
        }

        /* Responsive adjustments for chat */
        @media (max-width: 600px) {
            #aiAssistantButton {
                width: 50px;
                height: 50px;
                font-size: 1.5em;
                bottom: 20px;
                right: 20px;
            }
            /* Use: Adjusts AI button size and position for smaller screens. */
            #aiAssistantChat {
                width: calc(100% - 40px); /* Full width minus margin */
                height: calc(80vh - 100px); /* Adjust height */
                bottom: 80px;
                right: 20px;
            }
            /* Use: Adjusts chat window size and position for smaller screens. */
        }
    </style>
</head>
<body>
    <header class="navbar">
        <div class="navbar-container">
            <div class="logo">
                <img src="Mylogo.png" alt="Prince Alex Logo" />
                </div>
            <nav class="nav-links">
                <a href="#">Home</a>
                <a href="about-us.html">About Us</a>
                <a href="#contact-us">Contact</a>
                <a href="ticket-lookup.html">Print Ticket</a>
                <a href="admin.html">Admin Login</a>
                <a href="login-register.html">Login / Register</a>
                </nav>
        </div>
    </header>

    <section class="hero">
        <h1>Welcome to Prince Alex Digital Travel Services</h1>
        <h2>Travel with Comfort and Safety</h2>
        <p>Your journey, our priority. Book your bus tickets online with Prince Alex Travel Services for a seamless experience.</p>
        </section>

    <section class="booking">
        <div class="booking-container">
            <h2>Book Your Ticket</h2>
            <form class="booking-form" onsubmit="event.preventDefault(); searchResults();">
                <select id="from" required>
                    <option value="">From</option>
                    <option>Nairobi</option>
                    <option>Kisumu</option>
                    <option>Eldoret</option>
                    <option>Mombasa</option>
                    <option>Nakuru</option>
                    <option>Kericho</option>
                    <option>Kakamega</option>
                    <option>Kitale</option>
                    <option>Nyeri</option>
                    <option>Busia</option>
                    </select>
                <select id="to" required>
                    <option value="">To</option>
                    <option>Nairobi</option>
                    <option>Kisumu</option>
                    <option>Eldoret</option>
                    <option>Mombasa</option>
                    <option>Nakuru</option>
                    <option>Kericho</option>
                    <option>Kakamega</option>
                    <option>Kitale</option>
                    <option>Nyeri</option>
                    <option>Busia</option>
                    </select>
                <input type="date" id="travelDate" required />
                <button type="submit">Search</button>
                </form>
        </div>
    </section>

    <section class="results-section" id="results"></section>
    <section class="gallery">
        <div class="gallery-container">
            <h2>Our Travel Experience</h2>
            <div class="image-grid">
                <img src="Bus1.png" alt="Luxury Bus">
                <img src="Bus2.png" alt="VIP Interior">
                <img src="Bus3.png" alt="Clean and Air Conditioned">
                </div>
        </div>
    </section>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section" id="contact-us">
                <h4>Contact Us</h4>
                <p>Email: senerwaalex@gmail.com</p>
                <p>Phone: +254 717 384 875</p>
                <p>Location: Nairobi, Kenya</p>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <a href="index.html">Home</a>
                <a href="about-us.html">About Us</a>
                <a href="ticket-lookup.html">Print Ticket</a>
                <a href="admin.html">Admin Login</a>
            </div>
            <div class="footer-section">
                <h4>Follow Us</h4>
                <a href="#">Facebook</a>
                <a href="#">Instagram</a>
                <a href="#">Twitter</a>
            </div>
        </div>
        <div class="footer-bottom">
            &copy; 2025 Prince Alex Digital. All rights reserved.
            </div>
    </footer>

    <div id="seatModal">
        <div>
            <h3 style="margin-bottom:15px;">Select Your Seat for <span id="busDetails"></span></h3>
            <div id="seatGrid"></div>
            <div style="margin-bottom:10px;">
                <input type="text" id="passengerName" placeholder="Your Full Name" required />
                <input type="text" id="passengerID" placeholder="ID Number" required />
                <select id="passengerGender" required>
                    <option value="">Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                    </select>
                <input type="tel" id="passengerPhone" placeholder="Phone Number" required />
                <input type="email" id="passengerEmail" placeholder="Email Address" required />
                </div>
            <button onclick="confirmBooking()">Proceed to Pay</button>
            <button onclick="closeModal()">Cancel</button>
            </div>
    </div>

    <div id="aiAssistantButton">
        <i class="fas fa-comments"></i>
        </div>

    <div id="aiAssistantChat" class="chat-hidden">
        <div class="chat-header">
            <h3>AI Assistant</h3>
            <button class="chat-close-btn" onclick="toggleChat()">&times;</button>
            </div>
        <div class="chat-body">
            <p>Hello! How can I assist you with your travel plans today?</p>
            </div>
        <div class="chat-footer">
            <input type="text" placeholder="Type your message..." />
            <button>Send</button>
            </div>
    </div>

    <script>
        // Set min date for travelDate input to today
        const today = new Date().toISOString().split("T")[0];
        // Use: Gets the current date in 'YYYY-MM-DD' format.
        document.getElementById("travelDate").setAttribute("min", today);
        // Use: Sets the minimum selectable date for the travel date input.

        let currentBusId = null;
        // Use: Stores the ID of the currently selected bus.
        let currentBusRoute = null;
        // Use: Stores the route (From-To) of the selected bus.
        let currentBusTime = null;
        // Use: Stores the departure time of the selected bus.
        let currentTravelDate = null;
        // Use: Stores the selected travel date.
        let currentBusPrice = null;
        // Use: Stores the price of the selected bus.

        // --- LocalStorage Utility Functions (Now primarily for Bookings) ---
        // getStoredBuses and setStoredBuses are no longer used for fetching buses
        // as data will be fetched directly from Supabase.
        /*
        function getStoredBuses() {
            const buses = localStorage.getItem('princeAlexBuses');
            return buses ? JSON.parse(buses) : [];
        }

        function setStoredBuses(buses) {
            localStorage.setItem('princeAlexBuses', JSON.stringify(buses));
        }
        */

        function getStoredBookings() {
            const bookings = localStorage.getItem('bookings');
            // Use: Retrieves booking data from local storage.
            return bookings ? JSON.parse(bookings) : [];
            // Use: Parses stored JSON string to array, or returns empty array if none.
        }

        function setStoredBookings(bookings) {
            localStorage.setItem('bookings', JSON.stringify(bookings));
            // Use: Stores booking data as a JSON string in local storage.
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById("seatModal").style.display = "none";
            document.getElementById('aiAssistantButton').addEventListener('click', toggleChat);
            const aiAssistantChat = document.getElementById('aiAssistantChat');
            aiAssistantChat.classList.add('chat-hidden');
        });

        // --- Front-end Booking System Functions ---

        async function searchResults() {
            const from = document.getElementById('from').value;
            const to = document.getElementById('to').value;
            const date = document.getElementById('travelDate').value;
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = '<h2>Search Results</h2>';
            resultsContainer.classList.add('active'); // Show results section

            if (from === to) {
                resultsContainer.innerHTML += '<p style="color: red; text-align: center;">Please choose different origin and destination.</p>';
                return;
            }

            try {
                // Query Supabase for buses matching origin, destination, and travel date
                const { data: buses, error } = await supabase
                    .from('buses')
                    .select('*')
                    .eq('origin', from)
                    .eq('destination', to)
                    .eq('travelDate', date);

                if (error) {
                    console.error('Error fetching buses:', error.message);
                    resultsContainer.innerHTML += `<p style="color: red; text-align: center;">Error searching for buses: ${error.message}</p>`;
                    return;
                }

                if (buses.length === 0) {
                    resultsContainer.innerHTML += `<p style="text-align: center;">No available buses for the route from <strong>${from}</strong> to <strong>${to}</strong> on <strong>${date}</strong>.</p>`;
                    return;
                }

                buses.forEach(item => {
                    const busImage = item.image || 'Bus1.png'; // Use default image if not available
                    resultsContainer.innerHTML += `
                        <div class="result-card">
                            <img src="${busImage}" alt="${item.origin} to ${item.destination}" />
                            <div class="result-details">
                                <h4>${item.origin} to ${item.destination}</h4>
                                <p>Departure: ${item.time}</p>
                                <p>Price: <strong>Ksh ${item.price}</strong></p>
                                <p>Total Seats: ${item.totalSeats}</p>
                                <p>Travel Date: ${item.travelDate}</p>
                            </div>
                            <button class="book-btn"
                                    data-bus-id="${item.id}"
                                    data-bus-route="${item.origin} to ${item.destination}"
                                    data-bus-time="${item.time}"
                                    data-travel-date="${item.travelDate}"
                                    data-bus-price="${item.price}"
                                    >Book Now</button>
                        </div>
                    `;
                });

                attachBookNowListeners();

            } catch (err) {
                console.error('An unexpected error occurred during search:', err.message);
                resultsContainer.innerHTML += `<p style="color: red; text-align: center;">An unexpected error occurred during search.</p>`;
            }
        }


        function attachBookNowListeners() {
            document.querySelectorAll('.book-btn').forEach(button => {
                button.removeEventListener('click', handleBookNowClick);
                button.addEventListener('click', handleBookNowClick);
            });
        }

        function handleBookNowClick(event) {
            const busId = event.target.dataset.busId;
            const busRoute = event.target.dataset.busRoute;
            const busTime = event.target.dataset.busTime;
            const travelDate = event.target.dataset.travelDate;
            const busPrice = event.target.dataset.busPrice;
            openSeatSelector(busId, busRoute, busTime, travelDate, busPrice);
        }

        async function openSeatSelector(busId, busRoute, busTime, travelDate, busPrice) {
            currentBusId = busId;
            currentBusRoute = busRoute;
            currentBusTime = busTime;
            currentTravelDate = travelDate;
            currentBusPrice = busPrice;

            document.getElementById("busDetails").textContent = `${busRoute} at ${currentBusTime} on ${currentTravelDate}`;
            await generateSeats(); // Await seat generation as it now fetches bookings
            document.getElementById("seatModal").style.display = "flex";
        }

        function closeModal() {
            document.getElementById("seatModal").style.display = "none";
            document.getElementById("passengerName").value = '';
            document.getElementById("passengerID").value = '';
            document.getElementById("passengerGender").value = '';
            document.getElementById("passengerPhone").value = '';
            document.getElementById("passengerEmail").value = '';

            const selected = document.querySelector(".seat-container.selected");
            if (selected) selected.classList.remove("selected");
        }

        async function generateSeats() {
            const seatGrid = document.getElementById("seatGrid");
            seatGrid.innerHTML = "";

            // Fetch the bus details from Supabase to get totalSeats
            const { data: bus, error: busError } = await supabase
                .from('buses')
                .select('totalSeats')
                .eq('id', currentBusId)
                .single(); // Use .single() to get a single record

            if (busError) {
                console.error('Error fetching bus details for seat generation:', busError.message);
                // Handle error, maybe show a message to the user
                return;
            }

            const totalSeats = bus ? bus.totalSeats : 32; // Default to 32 if not found or error

            // Fetch bookings for this specific bus and travel date from Supabase
            const { data: bookedSeatsData, error: bookingsError } = await supabase
                .from('bookings')
                .select('seatNumber')
                .eq('busId', currentBusId)
                .eq('travelDate', currentTravelDate)
                .neq('status', 'cancelled'); // Exclude cancelled bookings

            if (bookingsError) {
                console.error('Error fetching booked seats:', bookingsError.message);
                // Handle error
                return;
            }

            const bookedSeatsForThisTrip = bookedSeatsData.map(booking => booking.seatNumber);

            for (let i = 1; i <= totalSeats; i++) {
                const seatContainer = document.createElement("div");
                seatContainer.classList.add("seat-container");
                seatContainer.setAttribute("data-seat", i);

                const seatIcon = document.createElement("i");
                seatIcon.classList.add("fas", "fa-chair", "seat-icon");

                const seatNumber = document.createElement("span");
                seatNumber.classList.add("seat-number");
                seatNumber.textContent = `S${i}`;

                seatContainer.appendChild(seatIcon);
                seatContainer.appendChild(seatNumber);

                if (bookedSeatsForThisTrip.includes(i)) {
                    seatContainer.classList.add("booked");
                    seatContainer.onclick = null;
                } else {
                    seatContainer.onclick = function () {
                        const selected = seatGrid.querySelector(".seat-container.selected");
                        if (selected) selected.classList.remove("selected");
                        seatContainer.classList.add("selected");
                    };
                }
                seatGrid.appendChild(seatContainer);
            }
        }


        async function confirmBooking() {
            const name = document.getElementById("passengerName").value;
            const idNumber = document.getElementById("passengerID").value;
            const gender = document.getElementById("passengerGender").value;
            const phone = document.getElementById("passengerPhone").value;
            const email = document.getElementById("passengerEmail").value;
            const selectedSeat = document.querySelector(".seat-container.selected");

            if (!name || !idNumber || !gender || !phone || !email || !selectedSeat) {
                alert("Please fill all required passenger details and select a seat.");
                return;
            }

            const seatNumber = parseInt(selectedSeat.dataset.seat);
            const bookingId = 'BOOK-' + Date.now(); // Simple unique ID

            const newBooking = {
                id: bookingId,
                passengerName: name,
                passengerID: idNumber,
                passengerGender: gender,
                passengerPhone: phone,
                passengerEmail: email,
                busId: currentBusId,
                busRoute: currentBusRoute,
                busTime: currentBusTime,
                travelDate: currentTravelDate,
                seatNumber: seatNumber,
                price: currentBusPrice,
                status: 'pending', // Initial status
                bookingDate: new Date().toISOString().split('T')[0]
            };

            try {
                const { data, error } = await supabase
                    .from('bookings')
                    .insert([newBooking]);

                if (error) {
                    throw error;
                }

                // Store the ID of the just-booked item for the success page
                localStorage.setItem('lastBookingId', newBooking.id);

                alert("Booking confirmed! Redirecting to payment page.");
                closeModal();
                window.location.href = 'booking-success.html';

            } catch (error) {
                console.error('Error confirming booking:', error.message);
                alert('Failed to confirm booking: ' + error.message);
            }
        }


        function toggleChat() {
            const chatContainer = document.getElementById('aiAssistantChat');
            const isHidden = chatContainer.classList.contains('chat-hidden');

            if (isHidden) {
                chatContainer.classList.remove('chat-hidden');
                setTimeout(() => {
                    chatContainer.classList.add('chat-visible');
                }, 10);
            } else {
                chatContainer.classList.remove('chat-visible');
                setTimeout(() => {
                    chatContainer.classList.add('chat-hidden');
                }, 300);
            }
        }
    </script>
</body>
</html>